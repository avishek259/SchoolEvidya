angular.module("schoolApp",["ionic","schoolApp.accountControl","schoolApp.gpsControl","schoolApp.tabsController","schoolApp.mainController","schoolApp.loginController","schoolApp.dashBoardControl","schoolApp.routing","schoolApp.services","schoolApp.constants","schoolApp.serviceInterface"]).config(["$ionicConfigProvider","$compileProvider","$httpProvider",function(e,o,t){e.tabs.position("bottom"),e.tabs.style("standard"),o.imgSrcSanitizationWhitelist(/\/img|..\/\b/),t.defaults.headers.common["Content-Type"]="application/json; charset=utf-8"}]).run(function(e){e.ready(function(){})});var routing=angular.module("schoolApp.routing",[]);routing.config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("main",{url:"/main",templateUrl:"mainContainer.html",abstract:!0,controller:"MainController"}).state("main.tabs",{url:"/tabs",views:{menuContent:{templateUrl:"tabs.html",controller:"TabsPageController"}}}).state("main.tabs.dash",{url:"/dash",views:{"tab-dash":{templateUrl:"app/templates/tab-dash.html",controller:"DashCtrl"}}}).state("main.tabs.gps",{url:"/gps",views:{"tab-gps":{templateUrl:"app/templates/tab-gps.html",controller:"gpsController"}}}).state("main.tabs.myaccount",{url:"/myaccount",views:{"tab-account":{templateUrl:"app/templates/tab-account.html",controller:"accountController"}}}).state("login",{url:"/login",templateUrl:"app/templates/login.html",controller:"LoginCtrl"}),o.otherwise("/login")}]);var accountControl=angular.module("schoolApp.accountControl",[]);accountControl.controller("accountController",["$scope","$rootScope",function(e,o){}]);var dashBoardControl=angular.module("schoolApp.dashBoardControl",[]);dashBoardControl.controller("DashCtrl",function(e,o,t,n,r,a,s,l,i){function c(e,o){var t=1;return angular.isDefined(e)&&angular.isDefined(o)&&(t=(o.getTime()-e.getTime())/864e5),t}i.hide(),e.groups=[],a.fromTemplateUrl("./app/templates/modalpopup.html",{scope:e}).then(function(o){e.notificationmodal=o}),e.slideChanged=function(o){e.slideIndex=o},e.aImages=[{src:"./app/img/diwalicrackers.png",msg:""},{src:"./app/img/diwali.png",msg:""},{src:"./app/img/diwalilights.png",msg:""}],e.openModal=function(){e.notificationmodal.show(),s.update()};for(var u=0;u<2;u++)e.groups[u]={name:"Leave Request",items:[]};e.items=[{id:0},{id:1},{id:2},{id:3},{id:4}],e.groups[0].name="Leave Request",e.groups[1].name="Notification History",e.sampledate=new Date,e.toggleGroup=function(o){e.isGroupShown(o)?e.shownGroup=null:e.shownGroup=o},e.isGroupShown=function(o){return e.shownGroup===o},e.applyLeave=function(){var o=r.BASEURL+r.SAVELEAVENOTE_URL,t=new Date,a=new Date(t.getTime()+432e6),s={};s.DeviceID=524241408,s.studentId="Hardik Amlani",s.LeaveTypeID="Sick Leave",s.LeaveFrom=t.getTime(),s.LeaveTo=a.getTime(),s.NoOfDays=c(t,a),s.Remarks="This is a Dummy Request",s.ApprovalStatus=0,s.IsActive=1,n.ajaxJSONPost(o,s).then(function(o){var t=n.successServiceCallBack(o);console.log(JSON.stringify(t)),e.showAlert("Leave request submitted successfully.")},function(o){var t=n.responsefailureCallBack(o);e.showAlert(t.errorString)})},e.showAlert=function(e){o.alert({title:"Result",template:e}).then(function(e){console.log("Message logged")})}});var gpsControl=angular.module("schoolApp.gpsControl",[]);gpsControl.controller("gpsController",["$scope","$rootScope",function(e,o){}]);var loginController=angular.module("schoolApp.loginController",[]);loginController.controller("LoginCtrl",function(e,o,t,n,r,a,s,l,i,c,u){e.data={},e.loginObj={username:"",password:""},e.tokenExist=!1,e.remember={val:!0},e.login=function(){var t=c.BASEURL+c.LOGINSERVICE_URL,r={};r.UserName=e.loginObj.username,r.Password=e.loginObj.password,u.ajaxJSONPost(t,r).then(function(t){u.successServiceCallBack(t);e.remember.val&&o.storeUsercreds(name+".yourServerToken"),s.titleofpage="DashBoard",a.go("main.tabs.dash")},function(e){u.responsefailureCallBack(e),n.alert({title:"Login failed!",template:"Please check your credentials!"})})},e.checkTokenExist=function(){e.tokenExist=o.loadUserCredentials(),e.tokenExist&&(o.show(),t(function(){o.hide(),s.titleofpage="DashBoard",a.go("main.tabs.dash")},500))},r.ready(function(){e.checkTokenExist()}),l.fromTemplateUrl("./app/templates/newuserRegistration.html",{scope:e}).then(function(o){e.userRegistration=o}),l.fromTemplateUrl("./app/templates/forgotPasswordScreen.html",{scope:e}).then(function(o){e.forgotPassword=o}),e.openModal=function(){e.userRegistration.show(),i.update()}});var mainController=angular.module("schoolApp.mainController",[]);mainController.controller("MainController",["$scope",function(e){e.toggleMenu=function(){e.sideMenuController.toggleLeft()}}]);var tabsControl=angular.module("schoolApp.tabsController",[]);tabsControl.controller("TabsPageController",["$scope","$state","$rootScope",function(e,o,t){e.leftButtons=[{type:"button-icon icon ion-navicon",tap:function(o){e.toggleMenu()}}],e.changetitle=function(e){switch(e){case 1:t.titleofpage="DashBoard",o.go("main.tabs.dash");break;case 2:t.titleofpage="Tracking",o.go("main.tabs.gps");break;case 3:t.titleofpage="Subscription",o.go("main.tabs.myaccount")}}}]);var conObj=angular.module("schoolApp.constants",[]);conObj.constant("requestURL",{BASEURL:"http://evidyaMobileService.iappsforme.com/",SAVELEAVENOTE_URL:"Parentservice.svc/SaveLeaveNote",LOGINSERVICE_URL:"api/Login/"}),conObj.constant("USER_ROLES",{admin:"admin_role",parent:"parent_role"});var servObj=angular.module("schoolApp.serviceInterface",[]);servObj.service("serviceUtility",function(e){this.ajaxJSONPost=function(o,t){return e({url:o,method:"POST",data:t})},this.successServiceCallBack=function(e){var o={};return 200==e.status&&(o=e.data),o},this.responsefailureCallBack=function(e){var o={};switch(e.status){case 400:o.statusCode=e.status,o.errorString="Your Request is inValid";break;case 401:o.statusCode=e.status,o.errorString="Your are unauthorized for the request you have made";break;case 403:o.statusCode=e.status,o.errorString="Your are forbidden to access the server";break;case 404:o.statusCode=e.status,o.errorString="The resource you are trying to access is not found on the server.";break;case 408:o.statusCode=e.status,o.errorString="Your Request has timed out";break;default:o.statusCode=e.status,o.errorString="Technical error has occured , please try again later."}return o}}),angular.module("schoolApp.services",[]).service("LoginService",function(e,o,t,n,r,a,s){function l(){u=void 0,m="",d=!1,o.defaults.headers.common["X-Auth-Token"]=u,window.localStorage.removeItem(p)}function i(e){m=e.split(".")[0],d=!0,u=e,"admin"==m&&(g=r.admin),"user"==m&&(g=r.parent),o.defaults.headers.common["X-Auth-Token"]=e}function c(e){window.localStorage.setItem(p,e),i(e)}var u,p="yourTokenKey",m="",d=!1,g="";return{loginUser:function(o,t,n){var r=e.defer(),a=r.promise;return"user"==o&&"secret"==t?(n&&c(o+".yourServerToken"),r.resolve("Welcome "+o+"!")):r.reject("Wrong credentials."),a.success=function(e){return a.then(e),a},a.error=function(e){return a.then(null,e),a},a},logout:function(){l()},username:function(){return m},show:function(){t.show({template:'<p>Loading...</p><ion-spinner icon="ripple" class="spinner-calm"></ion-spinner>'})},hide:function(){t.hide()},isAuthenticated:function(){return d},loadUserCredentials:function(){var e=window.localStorage.getItem(p);if(e)return i(e),e},storeUsercreds:function(e){c(e)}}});